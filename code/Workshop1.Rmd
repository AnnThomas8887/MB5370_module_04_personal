---
title: "MB5370 Module 04. Workshop 1 - Introduction"
author: "Ann Thomas"
output: html_document
date: "2024-03-19"
---

#Install knitr
```{r}
#install.packages("knitr")

```


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
# Install usethis
```{r}
#install.packages("usethis")

#library(usethis)
```

# Install and load tidyverse packages
```{r}
library("tidyverse")


```


# Load the data (mpg is built into ggplot2)
```{r}
data(mpg)
```


# Quick data checks
```{r}
head(mpg)
glimpse(mpg)
summary(mpg)
```




# Create first plot
```{r}
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy))
```

The plot shows a negative relationship between engine size (displ) and fuel efficiency (hwy). In other words, cars with big engines use more fuel. What does this say about fuel efficiency and engine size?

The scatter plot shows a negative correlation between engine size (displ) and fuel efficiency (hwy), indicating that as engine size increases, highway fuel efficiency decreases. This suggests that larger engines consume more fuel, making them less efficient than smaller engines.

# Understanding grammar of graphics
What happens if we just try to run ggplot on its own?
```{r}
ggplot() 
# Or with just the data specified?
ggplot(data = mpg)
```

We need to map some aesthetics!!

# When you’re creating a plot, you essentially need two attributes of a plot: a geom and aesthetics.
```{r}
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy, colour = class))
```


# Change point colour by class:
```{r}
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy, colour = class))
```

# Change point size by class:
```{r}
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy, size = class))# The size of the points are changed here
```
Note the warning!!!


# Change transparency (alpha) by class
```{r}
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy, alpha = class))#The shading is changed
```
Another warning!!
Question: When would using alpha (or size be appropriate??)

# Change point shape by class:
```{r}
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy, shape = class))#The shapes of the classes are changed
```


# Make all points blue
```{r}
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy), color = "blue")#The color is changed to all blue
```


# Troubleshooting 

```{r}
ggplot(data = mpg) +  
  geom_point(mapping = aes(x = displ, y = hwy))  ## the + should not be on the next line

```





# Faceting

## facet_wrap
Split the plot out by car type (class)
```{r}
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy)) + 
  facet_wrap(~ class, nrow = 2)
```


## facet_grid
A separate facet for each combination of drive-type (e.g. 4WD) * number of cylinders
```{r}
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy)) + 
  facet_grid(drv ~ cyl)
```
Note that there are no occurrences of 5 cylinder 4WDs OR RWD vehicles!


## facet_grid by just row (or column)
```{r}
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy)) + 
  facet_grid(cyl ~ .)
  #facet_grid(. ~ cyl) # Alternatively

```

# Exercise:
Read ?facet_wrap. What does nrow do? What does ncol do? What other options control the layout of the individual panels? 

nrow: Sets the number of rows in the facet layout.
ncol: Sets the number of columns in the facet layout.
Other layout options:
scales: Controls whether axes are fixed ("fixed", default) or adjusted ("free", "free_x", "free_y").
strip.position: Changes the position of facet labels ("top", "bottom", "left", "right").

```{r}

```


# Lines
We already used points:
```{r}
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy))
```


However, ggplot2 can use a variety of geom objects to represent the data. Here, we might want to use bar plots, line charts, boxplots and so on. Well we can handle this issue in ggplot directly using a different geom to plot the same data. Here, instead of plotting points, we will use a smooth line. 

# To display the same data as a smooth line fit through the points use geom_smooth().
```{r}
ggplot(data = mpg) + 
  geom_smooth(mapping = aes(x = displ, y = hwy))
```
### Question: whey don't we use geom_line() here? What would that look like? ###
### Because the data developed here doesnt fit in a straight ine
#We use geom_smooth() instead of geom_line() because geom_smooth() fits a trend line with a confidence interval, whereas geom_line() simply connects data points in the order they appear, which may not always reveal underlying patterns.

So let’s recap. A geom is an object that your plot uses to represent the data. To change the geom type in your plot, simply change the geom function that you add to your plot template. Sometimes you may want to try a few things out, in which case you could use comments to help you remember what worked and what didn’t. 

## Using comments (#)
```{r}
ggplot(data = mpg) + 
  #geom_point(mapping = aes(x = displ, y = hwy)) + # points horrible #Would create a scatter plot
  geom_smooth(mapping = aes(x = displ, y = hwy)) # try smooth line
```

Question: how does R work out where to plot the line??? Can use the chunk output to inform us. Can also use the help menu.

# Changing linetype
```{r}
ggplot(data = mpg) + 
  geom_smooth(mapping = aes(x = displ, y = hwy, linetype = drv)) # Can also use "lty = " for the same result
```


# Grouping
```{r}
ggplot(data = mpg) +
  geom_smooth(mapping = aes(x = displ, y = hwy, group = drv))
```
 
# Change line colour based on drv value
```{r}
ggplot(data = mpg) +
  geom_smooth(
    mapping = aes(x = displ, y = hwy, color = drv),
    show.legend = FALSE,
  )
```

# Multiple geoms
We already did this one way
```{r}
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy)) +
  geom_smooth(mapping = aes(x = displ, y = hwy))
```

A better way...
```{r}
ggplot(data = mpg, mapping = aes(x = displ, y = hwy)) + 
  geom_point() + 
  geom_smooth()
```


# Can still manipulate each geom/layer separately:
```{r}
ggplot(data = mpg, mapping = aes(x = displ, y = hwy)) + 
  geom_point(mapping = aes(color = class)) + 
  geom_smooth()
```

Now we have different colours to indicate the raw data (geom_point) and one colour for the overall relationship (geom_smooth). Neat!


```{r}
ggplot(data = mpg, mapping = aes(x = displ, y = hwy)) + 
  geom_point(mapping = aes(color = class)) + 
  geom_smooth(data = filter(mpg, class == "subcompact"), se = FALSE)
```
Question: what does the "se = FALSE" do?


# Exercise:
1.  What geom would you use to draw a line chart? A boxplot? A histogram? An area chart?
2.  Run this code in your head and predict what the output will look like. Then, run the code in R and check your predictions.
# 1. Use geom_line() to connect data points with a line
```{r}
ggplot(data = mpg) + 
  geom_line(mapping = aes(x = displ, y = hwy))

```

#    Use geom_boxplot() to create a boxplot
```{r}
ggplot(data = mpg) + 
  geom_boxplot(mapping = aes(x = class, y = hwy))

```

#    Use geom_histogram() to create a histogram
```{r}
ggplot(data = mpg) + 
  geom_histogram(mapping = aes(x = hwy), bins = 20)
```

#    Use geom_area() to create an area chart

```{r}
ggplot(data = mpg) + 
  geom_area(mapping = aes(x = displ, y = hwy))
```


3.  Will these two graphs look different? Why/why not?
```{r}
ggplot(data = mpg, mapping = aes(x = displ, y = hwy)) + 
  geom_point() + 
  geom_smooth()

ggplot() + 
  geom_point(data = mpg, mapping = aes(x = displ, y = hwy)) + 
  geom_smooth(data = mpg, mapping = aes(x = displ, y = hwy))
```
# In the first plot, the data and mappings are passed globally to the ggplot() function.
# In the second plot, the data and mappings are explicitly passed to each individual geom_point() and geom_smooth().

# Transformations and stats

## Load data
```{r}
data("diamonds")
glimpse(diamonds)
```

# Bar plot
```{r}
ggplot(data = diamonds) + 
  geom_bar(mapping = aes(x = cut))
```

# Overriding defaults
Make some new data
```{r}
demo <- tribble(
  ~cut,         ~freq,
  "Fair",       1610,
  "Good",       4906,
  "Very Good",  12082,
  "Premium",    13791,
  "Ideal",      21551
)
demo
```


```{r}
ggplot(data = demo) +
  geom_bar(mapping = aes(x = cut, y = freq), stat = "identity")
```
Question: Why did we specify now specify a y axis?
We did not specify a y-axis in some of the geom_bar() or stat_count() examples because ggplot2 automatically calculates and assigns the y-axis values for bar charts.
In this case, we specified the y axis because we are using the stat = "identity" argument in geom_bar().

# What if we want to know the proportion rather than the absolute frequency?
# stat(prop) calculates the proportion 
```{r}
ggplot(data = diamonds) + 
  geom_bar(mapping = aes(x = cut, y = stat(prop), group = 1))
```

Question: does anyone get the warning that's in the workbook?
Warning: `stat(prop)` was deprecated in ggplot2 3.4.0.
If so, can use # geom_bar(mapping = aes(x = cut, y = stage(after_stat = prop), group = 1))

# Plotting statistical details
```{r}
ggplot(data = diamonds) + 
  stat_summary(
    mapping = aes(x = cut, y = depth),
    fun.min = min,
    fun.max = max,
    fun = median
  )
```


# Aesthetic adjustments adjustments
Another way to boost the way you can convey information with plots using ggplot2 is to use aesthetics like colour or fill to change aspects of bar colours. We already did this once, but there are multiple options available to you, including changing the fill our outline colours.

```{r}
ggplot(data = diamonds) + 
  geom_bar(mapping = aes(x = cut, colour = cut))
ggplot(data = diamonds) + 
  geom_bar(mapping = aes(x = cut, fill = cut))
```
Question: Does anyone notice anything different in the colour scheme of this plot?
(Hint: It's in the viridis colour palette (colour blind friendly), but why is it different from the colour palette we used earlier?)


Check out the difference:
```{r}
ggplot(data = mpg, mapping = aes(x = displ, y = hwy)) + 
  geom_point(mapping = aes(color = class)) 

ggplot(data = diamonds, mapping = aes(x = color, y = depth)) + 
  geom_point(mapping = aes(color = cut)) 
```


# Filling by a variable
Now try using these aesthetics to colour by another variable like clarity. Notice how the stacking is done automatically. This is done behind the scenes with a position argument.
```{r}
ggplot(data = diamonds) + 
  geom_bar(mapping = aes(x = cut, fill = clarity))
```


# To alter transparency (alpha)
```{r}
ggplot(data = diamonds, mapping = aes(x = cut, fill = clarity)) + 
  geom_bar(alpha = 1/5, position = "identity")
```


# To color the bar outlines with no fill color
```{r}
ggplot(data = diamonds, mapping = aes(x = cut, colour = clarity)) + 
  geom_bar(fill = NA, position = "identity")
```


# Position adjustments
position = "fill" works like stacking, but makes each set of stacked bars the same height.
```{r}
ggplot(data = diamonds) + 
  geom_bar(mapping = aes(x = cut, fill = clarity), position = "fill")
```


# position = "dodge" 
Places overlapping objects directly beside one another.
```{r}
ggplot(data = diamonds) + 
  geom_bar(mapping = aes(x = cut, fill = clarity), position = "dodge")
```

# Jittering
position = "jitter" adds a small amount of random noise to each point to avoid overplotting when points overlap. This is useful for scatterplots but not barplots.
```{r}
ggplot(data = mpg) + 
  #geom_point(mapping = aes(x = displ, y = hwy), position = "jitter")
  geom_point(mapping = aes(x = displ, y = hwy))
```
# Plot deconstruction Assessment
# Load necessary libraries
library(ggplot2)
library(readr)

# loading of extracted data
# Exported as CSV from webplotdigitizer, load it:
# Replace with actual file path

```{r}

getwd()
data <- read.csv("../data/Default Dataset.csv")
```


```{r}
# Assigning of meaningful column names
colnames(data) <- c("Year", "MLD")

# Check the structure again
glimpse(data)
```
```{r}
# Create an improved line plot
ggplot(data, aes(x = Year, y = MLD)) + 
  geom_line(color = "black", linewidth = 1) +  # Main trend line
  geom_point(color = "black", linewdith = 2) +  # Data points
  labs(title = "Improved Visualization of MLD Over Time",
       x = "Year",
       y = "Mixed Layer Depth (MLD in meters)") +
  theme_minimal() +  # Clean background
  theme(
    text = element_text(size = 14),  # Increase font size
    axis.title = element_text(face = "bold"),
    panel.grid.major = element_line(color = "gray90")  # Light grid lines
  )
```

```{r}
# Load the combined dataset
getwd()
data_combined <- read.csv("../data/wpd_datasets.csv")

```

```{r}
# Assign meaningful column names
colnames(data_combined) <- c("Year", "MLD", "Lower_CI", "Upper_CI", "Lower_CI_Extra", "Upper_CI_Extra")


data_combined <- data_combined %>%
  mutate(across(where(is.character), as.numeric))

# Check the structure again
glimpse(data_combined)
```

```{r}
ggplot(data_combined, aes(x = Year, y = MLD)) + 
  geom_ribbon(aes(ymin = Lower_CI, ymax = Upper_CI), fill = "gray", alpha = 0.3) +  # Proper confidence interval
 #geom_line(color = "black", size = 1) +  # Main trend line
  geom_point(color = "black", size = 2) +  # Data points
  labs(title = "Improved Visualization of MLD Over Time with Confidence Interval",
       x = "Year",
       y = "Mixed Layer Depth (MLD in meters)") +
  theme_minimal() +  # Clean background
  theme(
    text = element_text(size = 14),  # Increase font size
    axis.title = element_text(face = "bold"),
    panel.grid.major = element_line(color = "gray90")  # Light grid lines
  )
  

```
# Workshop2
# Labelling of the ggplot
# Mathematical expressions
```{r}
ggplot(mpg, aes(displ, hwy)) +
  geom_point(aes(color = class)) +
  geom_smooth(se = FALSE) +
  labs(
    title = expression(paste("Fuel efficiency decreases with engine size, ", beta, " = -0.5"))
  )

```
# Font customization
```{r}
ggplot(mpg, aes(displ, hwy)) +
  geom_point(aes(color = class)) +
  geom_smooth(se = FALSE) +
  labs(
    title = "Fuel efficiency generally decreases with engine size",
    subtitle = "Sports cars are an exception"
  ) +
  theme(
    plot.title = element_text(family = "Arial", face = "bold", size = 16),
    plot.subtitle = element_text(family = "Arial", face = "italic", size = 12)
  )

```
# Adjusting label positions


```{r}
ggplot(mpg, aes(displ, hwy)) +
  geom_point(aes(color = class)) +
  geom_smooth(se = FALSE) +
  labs(
    title = "Fuel efficiency and engine size",
    subtitle = "Analyzing the relationship",
    caption = "Data from fueleconomy.gov"
  ) +
  theme(
    plot.title = element_text(hjust = 0.5),  # Center title
    plot.subtitle = element_text(hjust = 0.5),  # Center subtitle
    plot.caption = element_text(hjust = 1)  # Right-align caption
  )

```

#  Annotations
```{r}
best_in_class <- mpg %>%
  group_by(class) %>%
  filter(row_number(desc(hwy)) == 1)  # Select the most fuel-efficient car in each class

ggplot(mpg, aes(displ, hwy)) +
  geom_point(aes(colour = class)) +  # Scatter plot with points colored by car class
  geom_text(aes(label = model), data = best_in_class)  # Add text labels with car model names for the most efficient cars

```

# Scales
```{r}
ggplot(mpg, aes(displ, hwy)) +
  geom_point(aes(colour = class)) +  # Scatter plot with points colored by car class
  scale_x_continuous(limits = c(0, 12)) +  # Set the x-axis limits from 0 to 12
  scale_y_continuous(limits = c(10, 40)) +  # Set the y-axis limits from 10 to 40
  scale_colour_discrete(name = "Car Class")  # Custom label for the color legend

```

# Axis ticks

```{r}
ggplot(mpg, aes(displ, hwy)) +
  geom_point() +  # Basic scatter plot
  scale_y_continuous(breaks = seq(15, 40, by = 5))  # Custom y-axis ticks every 5 units from 15 to 40

```
# Removing Axis Labels

```{r}
ggplot(mpg, aes(displ, hwy)) +
  geom_point() +  # Basic scatter plot
  scale_x_continuous(labels = NULL) +  # Suppress x-axis labels
  scale_y_continuous(labels = NULL)  # Suppress y-axis labels


```
#  Legends and colour schemes

```{r}
base <- ggplot(mpg, aes(displ, hwy)) +
  geom_point(aes(colour = class))  # Scatter plot with points colored by car class

# Position the legend on the left
base + theme(legend.position = "left")

# Position the legend on the top
base + theme(legend.position = "top")

# Position the legend on the bottom
base + theme(legend.position = "bottom")

# Position the legend on the right (default position)
base + theme(legend.position = "right")

# Hide the legend completely
base + theme(legend.position = "none")

```
# Replacing a scale

```{r}
# Log transformation of both axes (x: carat, y: price) to improve the visualization of the relationship
ggplot(diamonds, aes(carat, price)) +
  geom_bin2d() + 
  scale_x_log10() + 
  scale_y_log10()

```
```{r}
# Scatter plot with points colored by 'drv' (drive type) and default color scale
ggplot(mpg, aes(displ, hwy)) +
  geom_point(aes(color = drv))

# Scatter plot with points colored by 'drv' (drive type) and using ColorBrewer's "Set1" palette for color scale
ggplot(mpg, aes(displ, hwy)) +
  geom_point(aes(color = drv)) +
  scale_colour_brewer(palette = "Set1")
```
```{r}
# Add redundant shape mapping to ensure the plot is interpretable in black and white
ggplot(mpg, aes(displ, hwy)) +
  geom_point(aes(color = drv, shape = drv)) +
  scale_colour_brewer(palette = "Set1")
```
```{r}
# Custom color scale using pre-defined colors for 'Republican' and 'Democratic' parties
presidential %>%
  mutate(id = 33 + row_number()) %>%
  ggplot(aes(start, id, colour = party)) +
  geom_point() +
  geom_segment(aes(xend = end, yend = id)) +
  scale_colour_manual(values = c(Republican = "red", Democratic = "blue"))
```
```{r}
# Use of viridis color scale for a hexbin plot
#install.packages('viridis')
#install.packages('hexbin')
library(viridis)
library(hexbin)

df <- tibble( # Creating a sample dataset for plotting
  x = rnorm(10000),
  y = rnorm(10000)
)

# Hexbin plot with viridis color scale applied to the fill
ggplot(df, aes(x, y)) +
  geom_hex() + # Creates a hexagonal bin plot
  coord_fixed()

# Using the viridis color scale for the fill in the hexbin plot
ggplot(df, aes(x, y)) +
  geom_hex() +
  viridis::scale_fill_viridis() +
  coord_fixed()
```
# Themes
```{r}
# Scatter plot with a smooth line, using a black-and-white theme (theme_bw)
ggplot(mpg, aes(displ, hwy)) +
  geom_point(aes(color = class)) +
  geom_smooth(se = FALSE) +
  theme_bw()
```
```{r}
# Scatter plot with a smooth line, using a light theme (theme_light)
ggplot(mpg, aes(displ, hwy)) +
  geom_point(aes(color = class)) +
  geom_smooth(se = FALSE) +
  theme_light()
```
```{r}
# Scatter plot with a smooth line, using a classic theme (theme_classic)
ggplot(mpg, aes(displ, hwy)) +
  geom_point(aes(color = class)) +
  geom_smooth(se = FALSE) +
  theme_classic()
```
```{r}
# Scatter plot with a smooth line, using a dark theme (theme_dark)
ggplot(mpg, aes(displ, hwy)) +
  geom_point(aes(color = class)) +
  geom_smooth(se = FALSE) +
  theme_dark()
```

```{r}
# Custom theme to create a specific style for all plots
ggplot(mpg, aes(displ, hwy)) +
  geom_point(aes(color = class)) +
  geom_smooth(se = FALSE) +
  theme(
    panel.border = element_blank(),
    panel.grid.minor.x = element_blank(),
    panel.grid.minor.y = element_blank(),
    legend.position = "bottom",
    legend.title = element_blank(),
    legend.text = element_text(size = 8),
    panel.grid.major = element_blank(),
    legend.key = element_blank(),
    legend.background = element_blank(),
    axis.text.y = element_text(colour = "black"),
    axis.text.x = element_text(colour = "black"),
    text = element_text(family = "Arial")
  )
```

